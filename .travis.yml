language: python
cache: pip

jobs:
  include:
    - dist: trusty
      addons:
        mariadb: 10.3
    - dist: trusty
      addons:
        mariadb: 10.4
    - dist: xenial
      addons:
        mariadb: 10.3
    - dist: xenial
      addons:
        mariadb: 10.4
    - dist: bionic
      addons:
        mariadb: 10.3
    - dist: bionic
      addons:
        mariadb: 10.4

install:
  - mysql --version
  - mysql -u root -e "SET GLOBAL character_set_server = 'utf8mb4'"
  - mysql -u root -e "SET GLOBAL collation_server = 'utf8mb4_unicode_ci'"

  - mysql -u root -e "CREATE DATABASE test_frappe"
  - mysql -u root -e "CREATE USER 'test_frappe'@'localhost' IDENTIFIED BY 'test_frappe'"
  - mysql -u root -e "GRANT ALL PRIVILEGES ON \`test_frappe\`.* TO 'test_frappe'@'localhost'"

  # https://github.com/frappe/erpnext/blob/develop/.travis.yml#L59
  - mysql -u root -e "UPDATE mysql.user SET Password=PASSWORD('travis') WHERE User='root'" || true
  # first attempt
  - mysql -u root -e "UPDATE mysql.global_priv SET Password=PASSWORD('travis') WHERE User='root'" || true
  # second attempt
  - mysql -u root -e "SET Password=PASSWORD('travis')"
  - mysql -u root --password=travis -e "FLUSH PRIVILEGES"
